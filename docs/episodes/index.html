<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <meta name="title" content="Episodes / Podcast | Lx7.ca">
    <meta name="description" content="Watch and listen to Lx7 episodes exploring music production, AI creativity, and the future of tech culture. New conversations with Vergel dropping regularly.">
    <meta name="robots" content="index, follow">
    <meta name="language" content="English">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://lx7.ca/episodes/">
    <meta property="og:title" content="Episodes / Podcast | Lx7.ca">
    <meta property="og:description" content="Watch and listen to Lx7 episodes exploring music production, AI creativity, and the future of tech culture. New conversations with Vergel dropping regularly.">
    <meta property="og:site_name" content="Lx7.ca">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary">
    <meta property="twitter:url" content="https://lx7.ca/episodes/">
    <meta property="twitter:title" content="Episodes / Podcast | Lx7.ca">
    <meta property="twitter:description" content="Watch and listen to Lx7 episodes exploring music production, AI creativity, and the future of tech culture. New conversations with Vergel dropping regularly.">

    <!-- Theme Color for browsers -->
    <meta name="theme-color" content="#0984e3" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#2d3436" media="(prefers-color-scheme: dark)">

    <title>Episodes / Podcast | Lx7.ca</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="icon" type="image/png" sizes="192x192" href="../images/icons/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="../images/icons/icon-512.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Privacy-friendly analytics by Plausible -->
    <script async src="https://plausible.io/js/pa-jBMicE0JgNYr8TdXhtBJ1.js"></script>
    <script>
      window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
      plausible.init()
    </script>
</head>
<body>
    <header class="header" role="banner">
        <ol>
            <li><a href="/" class="header-logo" aria-label="Home">Lx7.ca</a></li>
            <li><a href="/episodes" class="active" aria-label="Episodes">Episodes / Podcast</a></li>
            <li><a href="https://the-factory.lx7.ca" class="factory-link" target="_blank" rel="noopener noreferrer" aria-label="The Factory">The Factory <i class="fas fa-external-link-alt" aria-hidden="true"></i></a></li>
            <!-- <li><a href="/community" aria-label="Community">Community</a></li> -->
        </ol>
        
        <button class="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark mode">
            <i class="fas fa-moon" aria-hidden="true"></i>
        </button>
    </header>

    <div>
        <main class="episodes-container" role="main">
            <div class="episodes-header">
                <h1>Episodes</h1>
                <p class="episodes-tagline" id="show-tagline"></p>
                <div class="episodes-controls">
                    <label class="episodes-sort">
                        <span>Sort</span>
                        <select id="episodes-sort" aria-label="Sort episodes">
                            <option value="newest" selected>Newest to oldest</option>
                            <option value="oldest">Oldest to newest</option>
                        </select>
                    </label>
                </div>
            </div>
            
            <div class="episodes-grid" id="episodes-grid">
                <!-- Episodes will be loaded here -->
            </div>
        </main>
    </div>

    <footer role="contentinfo">
        <div id="dynamic-footer"></div>
    </footer>

    <script>
        // Theme toggle functionality
        document.addEventListener('DOMContentLoaded', () => {
            const themeToggle = document.querySelector('.theme-toggle');
            const icon = themeToggle.querySelector('i');
            
            themeToggle.addEventListener('click', () => {
                const html = document.documentElement;
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                html.setAttribute('data-theme', newTheme);
                
                icon.classList.toggle('fa-moon');
                icon.classList.toggle('fa-sun');
            });

            // Footer loader
            fetch('/metadata/footer.json')
                .then(response => response.json())
                .then(data => {
                    const footer = document.getElementById('dynamic-footer');
                    footer.innerHTML = `
                        <p>${data.footerText}</p>
                        <div class="footer-links">
                            ${data.links.map(link => {
                                if (link.text_extra) {
                                    return `<span><a href="${link.url}" target="_blank">${link.text}</a> ${link.text_extra}</span>`;
                                }
                                return `<a href="${link.url}" target="_blank">${link.text}</a>`;
                            }).join('')}
                        </div>
                    `;
                });

            // Episodes loader
            fetch('/metadata/episodes.json')
                .then(response => response.json())
                .then(data => {
                    // Set show tagline
                    document.getElementById('show-tagline').textContent = data.show.tagline;

                    const grid = document.getElementById('episodes-grid');
                    const sortSelect = document.getElementById('episodes-sort');
                    const episodes = [...data.episodes];

                    const parseDate = (value) => {
                        const parsed = new Date(value);
                        return Number.isNaN(parsed.getTime()) ? 0 : parsed.getTime();
                    };

                    const renderEpisodes = (items) => {
                        grid.innerHTML = items.map(episode => `
                        <div class="episode-card">
                            <div class="episode-thumbnail">
                                <iframe 
                                    width="100%" 
                                    height="200" 
                                    src="https://www.youtube.com/embed/${episode.youtube_id}" 
                                    frameborder="0" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                    allowfullscreen>
                                </iframe>
                            </div>
                            <div class="episode-info">
                                <h3 class="episode-title">${episode.title}</h3>
                                <p class="episode-meta">${episode.published} â€¢ ${episode.duration} mins</p>
                                <p class="episode-description">${episode.description}</p>
                                <div class="episode-topics">
                                    ${episode.topics.length > 4 
                                        ? episode.topics.slice(0, 3).map(topic => `<span class="topic-tag">${topic}</span>`).join('') + `<span class="topic-tag topic-more">+${episode.topics.length - 3}</span>`
                                        : episode.topics.map(topic => `<span class="topic-tag">${topic}</span>`).join('')
                                    }
                                </div>
                            </div>
                        </div>
                    `).join('');
                    };

                    const sortEpisodes = () => {
                        const sorted = [...episodes].sort((a, b) => {
                            const aDate = parseDate(a.published);
                            const bDate = parseDate(b.published);
                            return sortSelect.value === 'oldest' ? aDate - bDate : bDate - aDate;
                        });
                        renderEpisodes(sorted);
                    };

                    sortSelect.addEventListener('change', sortEpisodes);
                    sortEpisodes();
                })
                .catch(error => console.error('Failed to load episodes:', error));
        });
    </script>
</body>
</html>
